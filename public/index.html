<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Center City Duty</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>

<!-- ================= GUEST NAVBAR ================= -->
<nav class="navbar" id="guest-navbar">
  <div class="logo">
    <img src="/assets/logo.png" class="logo-img">
    CENTER CITY
  </div>

  <ul class="nav-links">
    <li><a href="/">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
    <li><a href="/duty.html">Duty</a></li>
    <li><a href="#">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a></li>
  </ul>

  <a href="/auth/discord" class="login-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
</nav>

<!-- ================= USER NAVBAR ================= -->
<nav class="navbar user-navbar" id="user-navbar" style="display:none">
  <!-- ‡∏ã‡πâ‡∏≤‡∏¢ -->
  <div class="logo">
    <img src="/assets/logo.png" class="logo-img">
    CENTER CITY
  </div>

  <!-- ‡∏Å‡∏•‡∏≤‡∏á -->
  <ul class="nav-links center-menu">
    <li><a href="/">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
    <li><a href="/duty.html">‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£-‡∏≠‡∏≠‡∏Å‡πÄ‡∏ß‡∏£</a></li>
    <li><a href="/history.html">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a></li>
    <li><a href="/admin" class="active">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</a></li>
  </ul>

  <!-- ‡∏Ç‡∏ß‡∏≤ : ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
  <div class="user-menu" id="userMenu">
    <img id="avatar" class="profile-avatar" />

    <!-- DROPDOWN -->
    <div class="dropdown luxury-profile">

      <!-- TOP -->
      <div class="profile-top">
        <img id="avatarLarge" class="profile-avatar-large" />
        <div class="profile-meta">
          <div id="username" class="profile-name">username</div>
          <div class="profile-badge">AGENCY</div>
        </div>
      </div>

      <!-- INFO -->
      <div class="profile-stats">
        <div>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô : <b id="agency">-</b></div>
        <div>‡∏¢‡∏® : <b id="rank">-</b></div>
        <div>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£‡∏™‡∏∞‡∏™‡∏° : <b id="dutyTime">0</b></div>
      </div>

      <div class="divider"></div>

      <!-- HISTORY -->
      <a href="/history.html" class="profile-link">
        ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </a>

      <!-- LOGOUT -->
      <a href="/logout" class="profile-logout">
        ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
      </a>
    </div>
  </div>
</nav>

<!-- ================= CONTENT ================= -->
<section class="hero">
  <h1><span>CENTER</span> CITY</h1>
  <p>‡∏£‡∏∞‡∏ö‡∏ö Duty ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ¬∑ Premium RP System</p>
</section>

<section class="stats">
  <div class="card">
    <h3>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h3>
    <span id="stat-online">0</span>
  </div>

  <div class="card">
    <h3>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</h3>
    <span id="stat-offline">0</span>
  </div>

  <div class="card">
    <h3>‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
    <span id="stat-duty">0</span>
  </div>

  <div class="card">
    <h3>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
    <span id="stat-total">0</span>
  </div>
</section>

<section class="systems">
  <a class="sys police" href="/duty.html">
    <h2>Police Duty</h2>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</p>
  </a>

  <a class="sys ems" href="/duty.html">
    <h2>Medic Duty</h2>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå</p>
  </a>

  <!-- ‚úÖ ADMIN PANEL (‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡∏ß‡∏≤‡∏™‡∏∏‡∏î) -->
  <a class="sys admin" href="/admin">
    <h2>Admin Panel</h2>
    <p>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
  </a>
</section>
  </a>
</section>
<section class="hero">
 <div class="duty-list-card">
  <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h2>

  <div class="duty-columns">
    <!-- POLICE -->
    <div class="duty-column">
      <div class="duty-title">üëÆ POLICE</div>
      <ul id="policeList" class="duty-names"></ul>
    </div>

    <!-- MEDIC -->
    <div class="duty-column">
      <div class="duty-title">üöë MEDIC</div>
      <ul id="medicList" class="duty-names"></ul>
    </div>
  </div>
</div>

</section>
<!-- ================= LOGIN CHECK ================= -->
<script>
fetch("/api/me", { credentials: "include" })
  .then(res => {
    if (!res.ok) throw new Error("not login");
    return res.json();
  })
  .then(user => {
    document.getElementById("guest-navbar").style.display = "none";
    document.getElementById("user-navbar").style.display = "flex";

    const avatarUrl = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`;

    document.getElementById("username").innerText = user.username;
    document.getElementById("avatar").src = avatarUrl;
    document.getElementById("avatarLarge").src = avatarUrl;

    document.getElementById("agency").innerText = user.agency || "-";
    document.getElementById("rank").innerText = user.rank || "-";
    document.getElementById("dutyTime").innerText = user.dutyTime || 0;
  })
  .catch(() => {
  document.getElementById("guest-navbar").style.display = "flex";
  document.getElementById("user-navbar").style.display = "none";

  // ‚ùå ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  document.querySelectorAll('a[href="/duty.html"], a[href="/history.html"], a[href="/admin.html"]')
    .forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ");
      });
    });
});

</script>

<!-- ================= DROPDOWN CLICK ================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  fetch("/api/users")
    .then(res => res.json())
    .then(users => {
      const policeList = document.getElementById("policeList");
      const medicList = document.getElementById("medicList");
      if (!policeList || !medicList) return;

      policeList.innerHTML = "";
      medicList.innerHTML = "";

      users
        .filter(u => u.onDuty) // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡∏£
        .forEach(u => {
          const li = document.createElement("li");
          li.innerHTML = `<span class="duty-dot"></span> ${u.name}`;

          if (u.role === "MEDIC") {
            medicList.appendChild(li);
          } else {
            policeList.appendChild(li);
          }
        });
    });
});

</script>
<script src="/js/index.js"></script>
</body>
</html>
